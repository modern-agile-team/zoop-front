name: ë©”ì¸ ë¹Œë“œ

on:
  push:
    branches:
      - main
      - develop

jobs:
  build:
    name: ë¹Œë“œ ë° ë°°í¬ í™•ì¸
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      - name: Corepack í™œì„±í™”
        run: corepack enable

      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: yarn install --immutable

      - name: ë¦°íŠ¸ ì‹¤í–‰
        run: yarn lint

      - name: í”„ë¡œì íŠ¸ ë¹Œë“œ
        run: yarn build:prod
        env:
          VITE_API_URL: ${{ vars.VITE_API_URL }}
          VITE_SOCKET_URL: ${{ vars.VITE_SOCKET_URL }}
          VITE_APP_ENV: prod

      - name: ë¹Œë“œ ì‚°ì¶œë¬¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: build-${{ github.sha }}
          path: build/
          retention-days: 7

      - name: ë¹Œë“œ ìš”ì•½
        run: |
          echo "## ğŸš€ ë¹Œë“œ ìš”ì•½" >> $GITHUB_STEP_SUMMARY
          echo "- **ë¸Œëœì¹˜**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ì»¤ë°‹**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ë¹Œë“œ ìƒíƒœ**: âœ… ì„±ê³µ" >> $GITHUB_STEP_SUMMARY
          echo "- **ë¹Œë“œ ì‹œê°„**: $(date)" >> $GITHUB_STEP_SUMMARY

  notify:
    name: ë¹Œë“œ ìƒíƒœ ì•Œë¦¼
    runs-on: ubuntu-latest
    needs: build
    if: failure()

    steps:
      - name: ë¹Œë“œ ì‹¤íŒ¨ ì•Œë¦¼
        run: |
          echo "âŒ ë¸Œëœì¹˜ ë¹Œë“œ ì‹¤íŒ¨: ${{ github.ref_name }}"
          echo "ì»¤ë°‹: ${{ github.sha }}"
          echo "ìì„¸í•œ ë‚´ìš©ì€ ë¹Œë“œ ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."
